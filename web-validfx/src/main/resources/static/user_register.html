<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户注册</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/easyui.css">
    <link rel="stylesheet" type="text/css" href="/css/icon.css">
    <style type="text/css">
        #ff label{
            display:block;
            width:100px;
        }
    </style>
    <script type="text/javascript" src="/js/jquery-1.6.1.min.js"></script>

    <script type="text/javascript" src="/js/HttpClient.js"></script>

    <script type="text/javascript">
        var api = new HttpClient();
        function register() {
            var form = $('#ff');
            console.log(form.form('validate'),"validate result");
            if(form.form('validate') || true) {
//                var userId = form.find("input[name='userId']").val();
//                var email = form.find("input[name='email']").val();

                var data = {};
                var inputs = form.find("[name]");
                inputs.each(function(index,element){
                    var name = $(element).attr("name");
                    data[name] = $(element).val();
                    //console.log(element,index);
                });
                api.post({
                    url: "/users/register", data: data, success: function (resp) {
                        console.log(resp);
                    }
                });
            }
        }
    </script>
</head>
<body>
<div style="width:230px;background:#fafafa;padding:10px;">
    <div style="padding:3px 2px;border-bottom:1px solid #ccc">用户注册</div>
    <form id="ff" method="post">
        <div>
            <label for="field_userId">用户名:</label>
            <input id="field_userId" class="easyui-validatebox" type="text" name="userId"></input>
        </div>
        <div>
            <label for="field_email">Email:</label>
            <input id="field_email" class="easyui-validatebox" type="text" name="email"></input>
        </div>
        <div>
            <label for="field_mobile">手机:</label>
            <input id="field_mobile" class="easyui-validatebox" type="text" name="phone"></input>
        </div>
        <div>
            <input type="button" onclick="javascript:register();" value="保存">
        </div>
    </form>
</div>
<!-- -->
<script type="text/javascript">
    var getValidType = function (rules) {
        for(var i in rules){
            var rule = rules[i];
            var ruleInfo = rule.name;
            if(rule.parameters){
                var ps = "";
                for(var p in rule.parameters){
                    if("message" == p)
                        continue;
                    ps += rule.parameters[p]+",";
                }
                if(ps.length > 1){
                    return ruleInfo + "[" + ps.substr(0,ps.length-1) + "]"
                }
            }
            return ruleInfo;
        }
    };
    var bindVoModel = function (json) {
        console.log(json,"bindVoModel");

        for(var i in json){
            var f = json[i];
            var form = $("#"+f.form);
            if(form[0]){
                for(var j in f.items){
                    var item = f.items[j];
                    var input = form.find("input[name='" + item.propertyName + "']");
                    if(input[0]){
                        if(item.required)
                            input.attr("required",item.required);
                        if(item.rules && item.rules.length > 0) {
                            var validType = getValidType(item.rules);
                            input.attr("validType", validType);
                        }
                    }
                }
            }
        }

//        $(function(){
//
//            // 通过json动态绑定校验
//            //*
//            // get(url) url = /vo_model.js  js扩展名的用意就是nginx可以做缓存
//            var json_validation ={"email": {"required":"true","validType":"email"},"userId":{"required":"true"}};
//
//            for(var field in json_validation){
//                var field_valid_data = json_validation[field];
//                // console.log(field,field_valid_data);
//                var input = $('#field_'+field)
//                for(var attr in field_valid_data){
//                    input.attr(attr,field_valid_data[attr]);
//                }
//            }
//            // */
//        });
    };
</script>
<script type="text/javascript" src="/validators/models/ff:user?callback=bindVoModel"></script>

<script type="text/javascript" src="/js/jquery.easyui.min.js"></script>

<!-- 自定义校验规则 -->
<script type="text/javascript" src="/js/validate-rules.js?4"></script>
<script type="text/javascript" src="/validators/rules?callback=extendValidateRules"></script>
</body>
</html>